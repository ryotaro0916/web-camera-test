<!DOCTYPE HTML>
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>HTML Media Capture Sample</title>
</head>
<body>
    <h1>HTML Media Capture Sample</h1>
    <form action="." method="post" enctype="multipart/form-data" onsubmit="return false;">
        <input type="tel" id="niukeid" onInput="scancheck()">
        <input type="file" id="cameraman" name="capture" accept="image/*" capture="camera"/>
        <input type="button" value="Upload" onclick="addressapi()"/>
    </form>
    <script>
    function ID(e){return document.getElementById(e);}
    function scancheck(){
        if (ID('niukeid').value.length == 6){
            ID('cameraman').click();
        }
        
    }
    

    function addressapi(){
        alert('いそまる水産');
        // make parameter
        var niukeid = ID('niukeid').value;
        if (niukeid){
            var sendData = JSON.stringify({'niukeid': niukeid});
            // send api
            var xhr = new XMLHttpRequest();
            xhr.open('POST',"http://baker.oroshi.toyoake.or.jp:5000/test/",true);
            xhr.setRequestHeader('Content-Type','application/json')
            xhr.send(sendData);

            // receive api response
            xhr.onreadystatechange = function() {
                if ( xhr.readyState == 4 && xhr.status == 200 ) {
                var data = JSON.parse(xhr.responseText);
                alert(data)
                }
            }
        }
        else{
            alert('荷受番号が入力されていません');
        }
    }
    </script>
</body>
</html>